<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Solar System Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        canvas { cursor: pointer; }
        #controls-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 300px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        #facts-panel {
            position: absolute;
            top: 20px;
            right: -400px; /* Start off-screen */
            width: 350px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: right 0.5s ease-in-out;
            color: #e5e7eb;
        }
        #facts-panel.visible {
            right: 20px;
        }
        #facts-panel h2 {
            font-size: 1.75rem;
            font-weight: bold;
            color: #fff;
        }
        #facts-panel p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }
        #facts-panel strong {
            color: #9ca3af;
            font-weight: 500;
        }
        .label {
            color: white;
            font-family: 'Inter', sans-serif;
            padding: 2px 5px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            text-shadow: 1px 1px 2px black;
            white-space: nowrap;
        }
        .date-picker-container input::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        .slider-thumb::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #3b82f6; cursor: pointer; border-radius: 50%; }
        .slider-thumb::-moz-range-thumb { width: 16px; height: 16px; background: #3b82f6; cursor: pointer; border-radius: 50%; }
        .toggle-switch { -webkit-appearance: none; appearance: none; width: 40px; height: 22px; background-color: rgba(255, 255, 255, 0.2); border-radius: 9999px; position: relative; cursor: pointer; transition: background-color 0.3s; }
        .toggle-switch::before { content: ''; position: absolute; width: 18px; height: 18px; background-color: white; border-radius: 50%; top: 2px; left: 2px; transition: transform 0.3s; }
        .toggle-switch:checked { background-color: #3b82f6; }
        .toggle-switch:checked::before { transform: translateX(18px); }
        .back-button { background-color: #3b82f6; border: none; color: white; padding: 10px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 16px; margin-top: 10px; cursor: pointer; border-radius: 8px; width: 100%; }
        .close-button { position: absolute; top: 10px; right: 10px; background: transparent; border: none; color: #9ca3af; font-size: 1.5rem; cursor: pointer; }
    </style>
</head>
<body class="bg-black">

    <div id="controls-panel" class="text-white text-sm space-y-4">
        <h1 class="text-xl font-bold">Solar System Explorer</h1>
        <div class="date-picker-container">
            <label for="currentDate" class="font-medium">Simulation Date</label>
            <input type="date" id="currentDate" class="mt-1 block w-full bg-gray-800 border border-gray-600 rounded-md p-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
            <label for="speedSlider" class="font-medium">Simulation Speed: <span id="speedValue">10x</span></label>
            <input id="speedSlider" type="range" min="0" max="1000" value="10" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-thumb mt-1">
        </div>
        <div>
            <label for="brightnessSlider" class="font-medium">Sun Brightness: <span id="brightnessValue">100%</span></label>
            <input id="brightnessSlider" type="range" min="20000" max="300000" value="150000" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-thumb mt-1">
        </div>
        <div class="flex items-center justify-between">
            <label for="toggleOrbits" class="font-medium">Show Orbits</label>
            <input type="checkbox" id="toggleOrbits" class="toggle-switch" checked>
        </div>
        <div class="flex items-center justify-between">
            <label for="toggleLabels" class="font-medium">Show Labels</label>
            <input type="checkbox" id="toggleLabels" class="toggle-switch" checked>
        </div>
        <button id="backButton" class="back-button" style="display: none;">Back to Solar System</button>
    </div>

    <div id="facts-panel">
        <button id="closeFacts" class="close-button">&times;</button>
        <div id="facts-content"></div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';
        import { Lensflare, LensflareElement } from 'three/addons/objects/Lensflare.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        let scene, camera, renderer, labelRenderer, controls, raycaster, mouse, composer, pointLight;
        let clock = new THREE.Clock();
        let simulationDate = new Date();
        let simulationSpeed = 10; // Days per second
        const textureLoader = new THREE.TextureLoader();
        const celestialObjects = [];
        const orbitLines = new THREE.Group();
        let focusedObject = null;
        const DEG2RAD = Math.PI / 180;

        const planetData = {
            sun: { name: 'Sun', radius: 20, isStar: true, textureUrl: 'textures/2k_sun.jpg', funFacts: { type: 'G-type main-sequence star', mass: '1.989 × 10^30 kg', temp: '5,778 K (surface)', gravity: '274 m/s²', atmosphere: 'Hydrogen, Helium', facts: 'The Sun contains 99.86% of the total mass of the Solar System. It fuses about 600 million tons of hydrogen into helium every second.'} },
            mercury: { name: 'Mercury', radius: 0.38, textureUrl: 'textures/2k_mercury.jpg', axialTilt: 0.03, semiMajorAxis: 0.387, eccentricity: 0.206, orbitalPeriod: 88, funFacts: { type: 'Terrestrial Planet', mass: '3.285 × 10^23 kg', temp: '-173 to 427 °C', gravity: '3.7 m/s²', atmosphere: 'Thin, exosphere', facts: 'A year on Mercury is just 88 Earth days long. It has the most eccentric orbit of any planet in the Solar System.'} },
            venus: { name: 'Venus', radius: 0.95, textureUrl: 'textures/2k_venus_surface.jpg', axialTilt: 177.4, semiMajorAxis: 0.723, eccentricity: 0.007, orbitalPeriod: 225, funFacts: { type: 'Terrestrial Planet', mass: '4.867 × 10^24 kg', temp: '462 °C (average)', gravity: '8.87 m/s²', atmosphere: 'Thick, Carbon Dioxide', facts: 'Venus rotates backwards compared to other planets. Its surface is hot enough to melt lead due to a runaway greenhouse effect.'} },
            earth: { name: 'Earth', radius: 1, textureUrl: 'textures/2k_earth_daymap.jpg', axialTilt: 23.4, semiMajorAxis: 1, eccentricity: 0.017, orbitalPeriod: 365.25, moon: { name: 'Moon', radius: 0.27, textureUrl: 'textures/2k_moon.jpg', semiMajorAxis: 0.00257, eccentricity: 0.055, orbitalPeriod: 27.3, funFacts: { type: 'Natural Satellite', mass: '7.342 × 10^22 kg', temp: '-233 to 123 °C', gravity: '1.62 m/s²', atmosphere: 'Very thin exosphere', facts: 'The Moon is Earth\'s only natural satellite and was formed 4.6 billion years ago. It is in synchronous rotation with Earth, always showing the same face.'} }, funFacts: { type: 'Terrestrial Planet', mass: '5.972 × 10^24 kg', temp: '-88 to 58 °C', gravity: '9.807 m/s²', atmosphere: 'Nitrogen, Oxygen', facts: 'Earth is the only known planet to harbor life. Its powerful magnetic field protects it from harmful solar winds.'} },
            mars: { name: 'Mars', radius: 0.53, textureUrl: 'textures/2k_mars.jpg', axialTilt: 25.2, semiMajorAxis: 1.52, eccentricity: 0.094, orbitalPeriod: 687, funFacts: { type: 'Terrestrial Planet', mass: '6.39 × 10^23 kg', temp: '-87 to -5 °C', gravity: '3.72 m/s²', atmosphere: 'Thin, Carbon Dioxide', facts: 'Mars is home to Olympus Mons, the largest volcano in the solar system. It has two small moons, Phobos and Deimos.'} },
            jupiter: { name: 'Jupiter', radius: 11.2, textureUrl: '2k_jupiter.jpg', axialTilt: 3.1, semiMajorAxis: 5.20, eccentricity: 0.049, orbitalPeriod: 4331, funFacts: { type: 'Gas Giant', mass: '1.898 × 10^27 kg', temp: '-145 °C (cloud tops)', gravity: '24.79 m/s²', atmosphere: 'Hydrogen, Helium', facts: 'Jupiter is more than twice as massive as all the other planets combined. Its Great Red Spot is a giant storm that has raged for centuries.'} },
            saturn: { name: 'Saturn', radius: 9.45, textureUrl: 'textures/2k_saturn.jpg', axialTilt: 26.7, semiMajorAxis: 9.58, eccentricity: 0.052, orbitalPeriod: 10747, ring: { innerRadius: 10.5, outerRadius: 20, textureUrl: 'textures/2k_saturn_ring_alpha.png' }, funFacts: { type: 'Gas Giant', mass: '5.683 × 10^26 kg', temp: '-178 °C (cloud tops)', gravity: '10.44 m/s²', atmosphere: 'Hydrogen, Helium', facts: 'Saturn\'s rings are made of billions of particles of ice and rock. The planet is less dense than water; it would float in a large enough bathtub.'} },
            uranus: { name: 'Uranus', radius: 4.0, textureUrl: 'textures/2k_uranus.jpg', axialTilt: 97.8, semiMajorAxis: 19.20, eccentricity: 0.047, orbitalPeriod: 30589, funFacts: { type: 'Ice Giant', mass: '8.681 × 10^25 kg', temp: '-224 °C (cloud tops)', gravity: '8.69 m/s²', atmosphere: 'Hydrogen, Helium, Methane', facts: 'Uranus is tilted on its side, with an axial tilt of 98 degrees. Methane in its atmosphere gives it a blue-green color.'} },
            neptune: { name: 'Neptune', radius: 3.88, textureUrl: 'textures/2k_neptune.jpg', axialTilt: 28.3, semiMajorAxis: 30.05, eccentricity: 0.010, orbitalPeriod: 59800, funFacts: { type: 'Ice Giant', mass: '1.024 × 10^26 kg', temp: '-214 °C (cloud tops)', gravity: '11.15 m/s²', atmosphere: 'Hydrogen, Helium, Methane', facts: 'Neptune has the fastest winds in the Solar System, reaching up to 2,100 km/h. It was the first planet located through mathematical prediction.'} }
        };
        const AU = 149.6;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 10000);
            camera.position.set(0, 150, 450);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            document.body.appendChild(renderer.domElement);

            labelRenderer = new CSS2DRenderer();
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.domElement.style.position = 'absolute';
            labelRenderer.domElement.style.top = '0px';
            labelRenderer.domElement.style.pointerEvents = 'none';
            document.body.appendChild(labelRenderer.domElement);
            
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.maxDistance = 2000;
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            const skyboxGeometry = new THREE.SphereGeometry(5000, 64, 64);
            const skyboxTexture = textureLoader.load('textures/8k_stars_milky_way.jpg');
            const skyboxMaterial = new THREE.MeshBasicMaterial({ map: skyboxTexture, side: THREE.BackSide });
            const skybox = new THREE.Mesh(skyboxGeometry, skyboxMaterial);
            scene.add(skybox);

            createSolarSystem();
            createAsteroidBelt(1.8 * AU, 3.2 * AU, 20000, 0.1);
            createAsteroidBelt(30 * AU, 50 * AU, 5000, 0.2);

            scene.add(orbitLines);
            setupUI();

            composer = new EffectComposer(renderer);
            const renderPass = new RenderPass(scene, camera);
            composer.addPass(renderPass);
            const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
            bloomPass.threshold = 0.85; 
            bloomPass.strength = 1.2;
            bloomPass.radius = 0.3;
            composer.addPass(bloomPass);
            
            window.addEventListener('resize', onWindowResize, false);
            renderer.domElement.addEventListener('click', onMouseClick, false);
            animate();
        }

        function createCelestialObject(data) {
            const geometry = new THREE.SphereGeometry(data.radius, 64, 64);
            const texture = textureLoader.load(data.textureUrl);
            let material;
            if (data.isStar) {
                material = new THREE.MeshBasicMaterial({ map: texture });
                pointLight = new THREE.PointLight(0xffffff, 150000, 10000);
                scene.add(pointLight);

                const textureFlare0 = textureLoader.load('textures/lensflare/lensflare0.png');
                const textureFlare3 = textureLoader.load('textures/lensflare/lensflare3.png');
                const lensflare = new Lensflare();
                lensflare.addElement(new LensflareElement(textureFlare0, 700, 0, pointLight.color));
                lensflare.addElement(new LensflareElement(textureFlare3, 60, 0.6));
                lensflare.addElement(new LensflareElement(textureFlare3, 70, 0.7));
                lensflare.addElement(new LensflareElement(textureFlare3, 120, 0.9));
                lensflare.addElement(new LensflareElement(textureFlare3, 70, 1));
                pointLight.add(lensflare);

            } else {
                material = new THREE.MeshStandardMaterial({ map: texture, roughness: 0.6 });
            }
            const mesh = new THREE.Mesh(geometry, material);
            mesh.rotation.x = (data.axialTilt || 0) * DEG2RAD;

            const labelDiv = document.createElement('div');
            labelDiv.className = 'label';
            labelDiv.textContent = data.name;
            const label = new CSS2DObject(labelDiv);
            label.position.set(0, data.radius * 1.5, 0);
            mesh.add(label);

            const celestialObj = { ...data, mesh, label };
            mesh.userData = celestialObj;
            celestialObjects.push(celestialObj);
            scene.add(mesh);

            if (!data.isStar) {
                const points = [];
                const a = data.semiMajorAxis * AU;
                const b = a * Math.sqrt(1 - data.eccentricity**2);
                for (let i = 0; i <= 360; i++) {
                    const angle = i * DEG2RAD;
                    points.push(new THREE.Vector3(a * Math.cos(angle), 0, b * Math.sin(angle)));
                }
                const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);
                const orbitLine = new THREE.Line(orbitGeometry, new THREE.LineBasicMaterial({ color: 0x444444 }));
                orbitLine.position.x = -(a * data.eccentricity);
                orbitLines.add(orbitLine);
            }

            if (data.ring) {
                const ringTexture = textureLoader.load(data.ring.textureUrl);
                const ringGeometry = new THREE.RingGeometry(data.ring.innerRadius, data.ring.outerRadius, 64);
                const ringMaterial = new THREE.MeshBasicMaterial({ map: ringTexture, side: THREE.DoubleSide, transparent: true });
                const ringMesh = new THREE.Mesh(ringGeometry, ringMaterial);
                ringMesh.rotation.x = Math.PI / 2;
                mesh.add(ringMesh);
            }

            if (data.moon) {
                const moonData = data.moon;
                const moonScale = 15;
                const moonGeometry = new THREE.SphereGeometry(moonData.radius, 32, 32);
                const moonTexture = textureLoader.load(moonData.textureUrl);
                const moonMaterial = new THREE.MeshStandardMaterial({ map: moonTexture, roughness: 0.8 });
                const moonMesh = new THREE.Mesh(moonGeometry, moonMaterial);

                const moonLabelDiv = document.createElement('div');
                moonLabelDiv.className = 'label';
                moonLabelDiv.textContent = moonData.name;
                const moonLabel = new CSS2DObject(moonLabelDiv);
                moonLabel.position.set(0, moonData.radius * 2, 0);
                moonMesh.add(moonLabel);

                const moonObj = { ...moonData, mesh: moonMesh, label: moonLabel, isMoon: true };
                moonMesh.userData = moonObj;
                celestialObjects.push(moonObj);
                mesh.add(moonMesh);

                const points = [];
                const a = moonData.semiMajorAxis * AU * moonScale;
                const b = a * Math.sqrt(1 - (moonData.eccentricity ?? 0)**2);
                for (let i = 0; i <= 360; i++) {
                    const angle = i * DEG2RAD;
                    points.push(new THREE.Vector3(a * Math.cos(angle), 0, b * Math.sin(angle)));
                }
                const orbitGeometry = new THREE.BufferGeometry().setFromPoints(points);
                const moonOrbitLine = new THREE.Line(orbitGeometry, new THREE.LineBasicMaterial({ color: 0x666666 }));
                moonOrbitLine.userData.isMoonOrbit = true;
                moonOrbitLine.position.x = -(a * (moonData.eccentricity ?? 0));
                mesh.add(moonOrbitLine);
            }
        }
        
        function createAsteroidBelt(innerRadius, outerRadius, count, size) {
            const asteroids = new THREE.BufferGeometry();
            const positions = [];
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = THREE.MathUtils.randFloat(innerRadius, outerRadius);
                const y = THREE.MathUtils.randFloatSpread(5);
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                positions.push(x, y, z);
            }
            asteroids.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            const material = new THREE.PointsMaterial({ color: 0x666666, size: size, transparent: true, opacity: 0.6 });
            const asteroidField = new THREE.Points(asteroids, material);
            scene.add(asteroidField);
        }

        function createSolarSystem() {
            Object.values(planetData).forEach(data => createCelestialObject(data));
        }

        function setupUI() {
            const dateInput = document.getElementById('currentDate');
            dateInput.valueAsDate = simulationDate;
            dateInput.addEventListener('change', () => { simulationDate = dateInput.valueAsDate; });

            document.getElementById('speedSlider').addEventListener('input', e => { 
                simulationSpeed = Number(e.target.value); 
                document.getElementById('speedValue').textContent = `${simulationSpeed}x`; 
            });
            
            const brightnessSlider = document.getElementById('brightnessSlider');
            const brightnessValue = document.getElementById('brightnessValue');
            brightnessSlider.addEventListener('input', e => { 
                const intensity = Number(e.target.value);
                pointLight.intensity = intensity;
                const max = Number(brightnessSlider.max);
                const min = Number(brightnessSlider.min);
                brightnessValue.textContent = `${Math.round(((intensity - min) / (max - min)) * 100)}%`;
            });

            document.getElementById('toggleOrbits').addEventListener('change', e => { 
                const isVisible = e.target.checked;
                orbitLines.visible = isVisible; 
                scene.traverse(child => { if (child.userData.isMoonOrbit) child.visible = isVisible; }); 
            });
            document.getElementById('toggleLabels').addEventListener('change', e => { celestialObjects.forEach(obj => { obj.label.visible = e.target.checked; }); });
            document.getElementById('backButton').addEventListener('click', resetCamera);
            document.getElementById('closeFacts').addEventListener('click', resetCamera);
            
            const planetListContainer = document.createElement('div');
            planetListContainer.className = 'mt-4 pt-4 border-t border-gray-700';
            planetListContainer.innerHTML = `<h2 class="text-base font-semibold mb-2">Celestial Bodies</h2>`;

            const planetList = document.createElement('div');
            planetList.id = 'planet-list';
            planetList.className = 'space-y-1 max-h-52 overflow-y-auto pr-2'; 
            
            const scrollbarStyle = document.createElement('style');
            scrollbarStyle.textContent = `
                #planet-list::-webkit-scrollbar { width: 6px; }
                #planet-list::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 3px; }
                #planet-list::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 3px; }
                #planet-list::-webkit-scrollbar-thumb:hover { background: #2563eb; }
            `;
            document.head.appendChild(scrollbarStyle);

            for (const key in planetData) {
                const data = planetData[key];
                const planetLink = document.createElement('a');
                planetLink.textContent = data.name;
                planetLink.className = 'block p-2 bg-gray-800/50 hover:bg-gray-700/70 rounded-md cursor-pointer transition-colors duration-200 text-sm font-medium';
                planetLink.addEventListener('click', () => {
                    const targetObject = celestialObjects.find(obj => obj.name === data.name);
                    if (targetObject) {
                        focusOnObject(targetObject.mesh);
                    }
                });
                planetList.appendChild(planetLink);
                if (data.moon) {
                    const moonData = data.moon;
                    const moonLink = document.createElement('a');
                    moonLink.textContent = `  - ${moonData.name}`;
                    moonLink.className = 'block p-2 pl-4 bg-gray-800/50 hover:bg-gray-700/70 rounded-md cursor-pointer transition-colors duration-200 text-sm font-medium';
                     moonLink.addEventListener('click', () => {
                        const targetObject = celestialObjects.find(obj => obj.name === moonData.name);
                        if (targetObject) {
                            focusOnObject(targetObject.mesh);
                        }
                    });
                    planetList.appendChild(moonLink);
                }
            }

            planetListContainer.appendChild(planetList);
            document.getElementById('controls-panel').appendChild(planetListContainer);
        }

        function updatePositions() {
            const timeInDays = simulationDate.getTime() / (1000 * 60 * 60 * 24);
            const moonScale = 15;

            celestialObjects.forEach(obj => {
                obj.mesh.rotation.y += 0.005;

                if (obj.isStar) return;
                
                if (obj.isMoon) {
                    const M = (2 * Math.PI / obj.orbitalPeriod) * timeInDays;
                    const a = obj.semiMajorAxis * AU * moonScale;
                    const x = a * Math.cos(M);
                    const z = a * Math.sqrt(1 - obj.eccentricity**2) * Math.sin(M);
                    obj.mesh.position.set(x, 0, z);
                } else {
                    const M = (2 * Math.PI / obj.orbitalPeriod) * timeInDays;
                    const a = obj.semiMajorAxis * AU;
                    const x = a * (Math.cos(M) - obj.eccentricity);
                    const z = a * Math.sqrt(1 - obj.eccentricity**2) * Math.sin(M);
                    obj.mesh.position.set(x, 0, z);
                }
            });
        }
        
        function onMouseClick(event) {
            if (event.target.closest('#controls-panel') || event.target.closest('#facts-panel')) return;

            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children, true);
            if (intersects.length > 0 && intersects[0].object.userData.name) {
                focusOnObject(intersects[0].object);
            }
        }
        
        function focusOnObject(object) {
            focusedObject = object;
            document.getElementById('backButton').style.display = 'block';
            updateFactsPanel(object.userData);
        }

        function resetCamera() {
            focusedObject = null;
            document.getElementById('backButton').style.display = 'none';
            document.getElementById('facts-panel').classList.remove('visible');
        }

        function updateFactsPanel(data) {
            const funFacts = data.funFacts || (data.parentBody && data.parentBody.funFacts);
            const content = `
                <h2 class="mb-4">${data.name}</h2>
                <p><strong>Type:</strong> ${funFacts.type}</p>
                <p><strong>Mass:</strong> ${funFacts.mass}</p>
                <p><strong>Surface Temp:</strong> ${funFacts.temp}</p>
                <p><strong>Gravity:</strong> ${funFacts.gravity}</p>
                <p><strong>Atmosphere:</strong> ${funFacts.atmosphere}</p>
                <p class="mt-4">${funFacts.facts}</p>
            `;
            document.getElementById('facts-content').innerHTML = content;
            document.getElementById('facts-panel').classList.add('visible');
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            const millisecondsToAdvance = delta * simulationSpeed * 24 * 60 * 60 * 1000;
            simulationDate.setTime(simulationDate.getTime() + millisecondsToAdvance);
            document.getElementById('currentDate').valueAsDate = simulationDate;

            updatePositions();
            
            if (focusedObject) {
                const targetPosition = new THREE.Vector3();
                focusedObject.getWorldPosition(targetPosition);
                
                const radius = focusedObject.userData.radius || 1;
                const cameraOffset = new THREE.Vector3(0, radius * 1.5, radius * 3.5);
                const desiredCameraPosition = targetPosition.clone().add(cameraOffset);

                camera.position.lerp(desiredCameraPosition, 0.05);
                controls.target.lerp(targetPosition, 0.05);
            } else {
                 controls.target.lerp(new THREE.Vector3(0,0,0), 0.05);
            }

            controls.update();
            composer.render();
            labelRenderer.render(scene, camera);
        }
        
        init();
    </script>
</body>
</html>


